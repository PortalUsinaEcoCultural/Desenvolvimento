<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site Usina Eco-Cultural</title>
    <link rel="shortcut icon" href="/Imagens/logoBranca.png" type="image/x-icon">

    <link rel="stylesheet" href="/CSS/formsDoe.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <!-- Cabeçalho -->
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 logo bg-white text-center p-3">
                <a href="/HTML/doe.html">
                    <button class="back-btn">&lt;</button>
                </a>
                <img src="/Imagens/img-Fale_Conosco/logo.jpg" width="66px" alt="Logo Usina Eco-Cultural">
            </div>
        </div>
    </div>

    <!-- Formulário -->
    <div class="container px-3">
        <h2>Você está doando para <strong>Usina Eco-Cultural</strong></h2>
        <h3>Cada contribuição, grande ou pequena, faz a diferença.
            <br>Juntos, podemos construir um futuro mais justo e consciente.
        </h3>
        <form>
            <div class="form-group row">
                <div class="col-12 col-sm-6">
                    <label for="nome">Nome:</label>
                    <input type="text" id="nome" name="nome" class="form-control" placeholder="Digite seu nome" required>
                </div>
                <div class="col-12 col-sm-6">
                    <label for="sobrenome">Sobrenome:</label>
                    <input type="text" id="sobrenome" name="sobrenome" class="form-control" placeholder="Digite seu sobrenome" required>
                </div>
            </div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" class="form-control" placeholder="Digite seu email" required>
            </div>
            <div class="form-group">
                <label for="comentario">Deixe um comentário:</label>
                <textarea id="comentario" name="comentario" class="form-control" placeholder="Ex. uma ótima iniciativa! Fico feliz em poder contribuir." rows="3"></textarea>
            </div>
            <div class="form-groups mt-4">
                <label class="d-block mb-2">Escolha o <strong>método de pagamento:</strong></label>
                <button type="button" class="btn btn-pagamento" id="pixBtn">PIX</button>
                <button type="button" class="btn btn-pagamento" id="paypalBtn">PayPal</button>
            </div>
            <div>
                <button type="submit" class="btn btn-continuar w-100 mt-3" id="continuarBtn">Continuar &gt;</button>
            </div>
        </form>        
    </div>

    <script>
        document.querySelector('form').addEventListener('submit', async (event) => {
            event.preventDefault();
        
            const formData = {
            nome: document.getElementById('nome').value,
            sobrenome: document.getElementById('sobrenome').value,
            email: document.getElementById('email').value,
            comentario: document.getElementById('comentario').value,
            metodoPagamento: document.querySelector('.btn-pagamento.active')?.textContent || 'Não especificado',
            };
        
            try {
            const response = await fetch('http://localhost:3000/doacao', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData),
            });
        
            if (response.ok) {
                alert('Doação registrada com sucesso!');
            } else {
                alert('Erro ao registrar a doação. Tente novamente.');
            }
            } catch (error) {
            console.error('Erro:', error);
            }
        });
        
        document.querySelectorAll('.btn-pagamento').forEach((btn) => {
            btn.addEventListener('click', () => {
            document.querySelectorAll('.btn-pagamento').forEach((b) => b.classList.remove('active'));
            btn.classList.add('active');
            });
        });
        // Variáveis dos botões
        const pixBtn = document.getElementById('pixBtn');
        const paypalBtn = document.getElementById('paypalBtn');
        const continuarBtn = document.getElementById('continuarBtn');

        // Variável para verificar se o método PIX foi selecionado
        let metodoSelecionado = '';

        // Função para resetar a aparência dos botões
        function resetBotao() {
            pixBtn.classList.remove('selecionado');
            paypalBtn.classList.remove('selecionado');
        }

        // Ação do botão PIX
        pixBtn.addEventListener('click', function () {
            resetBotao(); // Resetar todos os botões
            pixBtn.classList.add('selecionado'); // Adiciona a classe de destaque no botão PIX
            metodoSelecionado = 'PIX'; // Marca que o método PIX foi selecionado
        });

        // Ação do botão PayPal
        paypalBtn.addEventListener('click', function () {
            resetBotao(); // Resetar todos os botões
            paypalBtn.classList.add('selecionado'); // Adiciona a classe de destaque no botão PayPal
            metodoSelecionado = 'PayPal'; // Marca que o método PayPal foi selecionado
        });

        // Ação do botão Continuar
        continuarBtn.addEventListener('click', function () {
            if (metodoSelecionado === 'PIX') {
                window.location.href = '/HTML/formsPix.html'; // Redireciona para o PIX quando o botão Continuar é clicado
            } else {
                // Pode adicionar uma mensagem de erro ou redirecionar para outro lugar, se necessário
                alert('Selecione um método de pagamento antes de continuar.');
            }
        });
    </script>

</body>

</html>
